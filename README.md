# Fallen Castle - Актуализированное ТЗ

## Жанр и суть проекта
**Жанр:** 2D roguelike с элементами action.  
**Суть:** Игрок исследует павший замок, состоящий из 3‑х этажей. Каждый этаж представляет собой сетку процедурно генерируемых комнат с разным содержанием. Сюжет раскрывается поэтапно, показывая, что главный герой на самом деле является злодеем, разрушившим замок тысячу лет назад.

---

## Основные функциональные требования

### 1) Игровой процесс и механики

**Структура игры:**
- 3 этажа (уровня):
  - Этаж 1: Крепостная стена
  - Этаж 2: Цитадель  
  - Этаж 3: Подземелье
- Уровни открываются последовательно после прохождения предыдущих
- Каждый уровень представляет собой сетку комнат 3×3 или 4×4
- Прогресс уровней сохраняется глобально

**Типы комнат:**
- Стартовая комната (место появления игрока)
- Обычные комнаты (боевые, с врагами)
- Комната с оружием (гарантированный спавн конкретного оружия)
- Комната со щитом (на 2 и 3 этажах)
- Сокровищница (требует ключ для открытия, содержит оружие и улучшения)
- Босс‑комната (финальная битва этажа)

**Система сюжета:**
- Вступительный текст для каждого этажа
- Постепенное раскрытие истории через текстовые вставки
- Две концовки (хорошая и плохая) в зависимости от прохождения

### 2) Система инвентаря и предметов

**Оружие игрока (6 типов):**
- Меч (стартовое) – прямое короткое поражение
- Топор – круговой урон с радиусом
- Лук – дальняя атака стрелами
- Алебарда – широкий секторный урон  
- Боевой молот – удар с оглушением врагов и разрушением препятствий
- Щит (не оружие, а активная способность) – блокирование снарядов

**Подбираемые предметы:**
- Ключи (открывают сокровищницы)
- Сердца (увеличивают максимальное здоровье и лечат)
- Оружие (заменяет текущее)

**Ограничения инвентаря:**
- Одно активное оружие (заменяется при подборе нового)
- Ключи и сердца – расходники без ограничений
- Щит – отдельный слот, на 2‑3 этажах

### 3) Система врагов и боевой системы

**Классы врагов:**

**Базовые:**
- Обычный враг (стандартные параметры)
- Быстрый враг (высокая скорость, низкое здоровье)
- Танк (много здоровья, медленный)
- Дальнобойный (стреляет стрелами)

**Элитные (на 2‑3 этажах):**
- Элитный бегун (способность к рывку)
- Элитный стрелок (залпы стрел)
- Элитный танк 3 этажа (удар с замедлением игрока)
- Элитный лучник 3 этажа (быстрые залпы)

**Боссы:**
- Босс 1 этажа: Классический босс с фазами, рывками
- Босс 2 этажа: Стреляющий босс с выравниванием и дашем
- Босс 3 этажа: Рыцарь с блоком, призывом союзников, горением

**Параметры врагов:**
- Здоровье: от 25 до 1200 (у боссов)
- Урон: от контакта и снарядов
- Особые способности: оглушение, замедление, горение

### 4) Игровая механика

**Движение игрока:**
- WASD – движение
- LShift – рывок (с кулдауном)
- Проверка коллизий со стенами и препятствиями

**Боевая система:**
- Стрелки – атака в направлении (разная для каждого оружия)
- Пробел – активация щита (если есть)
- Щит отражает вражеские снаряды, увеличивая их урон

**Специальные механики:**
- Оглушение (молотом)
- Замедление (от некоторых атак врагов)
- Горение (от босса 3 этажа)
- Разрушение препятствий (молотом)

### 5) Интерфейс

**HUD включает:**
- Здоровье игрока (численно и полоса)
- Количество ключей
- Текущее оружие
- Количество жизней (сердечки)
- Тип текущей комнаты
- Номер этажа
- Полоса здоровья босса (при бою с боссом)
- Индикаторы фаз и способностей босса
- Кнопка обучения (F1)

**Меню игры:**
- Главное меню (начать игру/выход)
- Выбор этажа (с отображением прогресса)
- Обучение (геймплейные подсказки)
- История/сюжет (текстовые страницы)
- Экран смерти (с возвратом в меню)
- Концовки (хорошая/плохая)

### 6) Управление

**Горячие клавиши:**
- **W/A/S/D** – движение
- **Стрелки** – атака в направлении
- **LShift** – рывок
- **Пробел** – щит (если есть)
- **E** – взаимодействие с дверьми
- **F1** – открыть обучение
- **ESC** – выход в главное меню (с уровня)
- **R** – перезапуск текущей комнаты (отладка)

---

## Технические требования

### Используемые технологии
- **Язык:** Python 3.9+
- **Библиотека:** Arcade 2.6+
- **Графика:** Спрайты и процедурная генерация
- **Структура проекта:** Один основной файл с классами

### Архитектурные особенности (реализованные)

#### 1) Основные классы
- `GameWindow` – главное окно
- `MainMenuView`, `FloorSelectionView`, `GameView` – различные состояния игры
- `Player` – управление игроком, здоровье, оружие
- `Enemy` и наследники – различные типы врагов
- `Boss` и наследники – боссы этажей
- `Floor` – генерация уровня и комнат
- `Room` – описание комнаты и ее содержимого

#### 2) Система отображения
- Пиксельная графика через спрайты и простые геометрические фигуры
- Анимации атак через временные объекты (sword_slashes, axe_swings и т.д.)
- Минимальные эффекты частиц (индикаторы способностей)

#### 3) Система состояний
- Отдельные View для каждого экрана игры
- Плавные переходы между состояниями
- Сохранение прогресса в глобальной переменной

#### 4) Физика и коллизии
- Простая проверка коллизий спрайтов
- Луч‑объект для меча
- Радиусные проверки для AOE‑атак
- Коллизии снарядов со стенами и врагами

### Требования к запуску
- Python 3.9 или новее
- Установленные зависимости: arcade, PIL
- Файлы ассетов в папке `assets/` (опционально, есть fallback)
- Разрешение экрана: 1280×720 (оптимально)

### Особенности реализации
- **Процедурная генерация:** комнаты, враги, предметы
- **Баланс сложности:** увеличение сложности с этажами
- **Сюжетная линия:** раскрывается постепенно через вступления
- **Система жизней:** 3 жизни на весь проход уровня
- **Система ключей:** для открытия сокровищниц
- **Множество типов оружия:** с уникальной механикой

### Изменения относительно исходного ТЗ
1. **Упрощена система сделок** (дьявол/ангел) – не реализована  
2. **Изменена система инвентаря** – упрощена, нет пассивных улучшений  
3. **Убраны мини‑боссы** в обычных комнатах  
4. **Добавлена система сюжета** с раскрытием личности героя  
5. **Добавлены разные концовки**  
6. **Реализована система этажей** с прогрессом  
7. **Добавлены разные типы комнат** с гарантированными предметами  
8. **Упрощена система HUD** под текущие нужды  

---

## Геймдизайн

### Прогрессия сложности
- **Этаж 1:** Базовые враги, простой босс  
- **Этаж 2:** Появление элитных врагов, более сложный босс, щит  
- **Этаж 3:** Мощные элитные враги, сложнейший босс, расширенный арсенал  

### Баланс
- Каждое оружие имеет уникальную нишу применения  
- Враги сконтрпримеры против определенного оружия  
- Боссы требуют освоения всех механик  
- Количество жизней ограничивает количество ошибок  

### Методология
- «Легко изучить, сложно освоить»  
- Постепенное введение механик  
- Возможность переигрывания для лучшего результата  
- Стимул исследовать все комнаты для поиска оружия  

---