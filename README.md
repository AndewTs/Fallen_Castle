# Fallen Castle

## Жанр и суть проекта
**Жанр:** Клссический roguelike.
**Суть:** Игрок изучает некогда павшую крепость. Внутри нее его ждет множество разнообразных врагов и опасные боссы. В зачистке каждого этажа ему помогут уникальные предметы.

---

## Основные функциональные требования

### 1) Игровой процесс и механики

- **Система этажей:**
  - Всего 3 этажа:
    - Этаж 1: Крепостная стена.
    - Этаж 2: Цитадель.
    - Этаж 3: Подземелье (открывается после прохождения игры на первых двух этажах).
  - На каждом этаже:
    - Случайно генерируемые комнаты:
      - Боевые комнаты (обычные враги).
      - Сокровищницы (предметы, ресурсы).
      - Секретные комнаты (для открытия либо специальный предмет, либо подорвать стену бомбой).
    - Босс в конце этажа.
    - Мини-боссы, которые начинают появляться в комнатах 2 и 3 этажах.

- **Система сделок:**
  - После победы над боссом без получения урона игроку предлагается сделка:
    - Дьявол (всегда на 1 этаже).
    - Ангел (открывается на следующем этаже, если на предыдущем отказаться от сделки с дьяволом. Но если хоть раз вы имели дело с дьяволом, ангел уже не откликнется на ваш зов).
  - Предметы из сделок обладают уникальными усиленными свойствами.

### 2) Система инвентаря и предметов
- **Типы предметов:**
  - Оружие (им вы атакуете).
  - Броня (увеличивает защиту игрока).
  - Пассивные улучшения (действуют постоянно, например, увеличение скорости).
  - Активные предметы (требуют активации игроком, имеют перезарядку).
- **Инвентарь:**
  - 1 слот под оружие (потом можно заменить). 2 слота под броню (при подборе новой также можно заменить одну из). 1 слот под активный предмет (меняется при подборе нового). Неограниченные слоты для пассивных улучшений
  - Между некоторыми предметами может возникнуть синергия, улучшаящая их характеристики или дарующая новые способности.
  - Подбираемые предметы. Могут выпадать после зачистки комнаты и тратятся при использовании.:
    - Сердца для восстановления здоровья.
    - Бомбы.
    - Щит (при подборе активируется и блокирует несколько следующих атак).
    - Ключи (для открытия специальных комнат. таких как сокровищница).

### 3) Система врагов и боевой системы
- **Типы врагов:**
  - Обычные враги (мечники, стрелки, маги).
  - Мини-боссы (усиленные версии обычных врагов).
  - Боссы (уникальные противники с несколькими фазами).
- **Параметры врагов:**
  - Здоровье (HP): от 20 до 500 в зависимости от типа.
  - Урон за один удар: от 5 до 50 HP.
  - Скорость передвижения и атаки.
  - Особые способности (например, оглушение, отравление).

### 4) Графика и интерфейс
- **Графика:**
  - Стиль: пиксель-арт или стилизованная 2D-графика.
  - Анимации:
    - Персонаж (ходьба, получение урона).
    - Симбиот (вращение, атака, изменение формы в зависимости от настроения).
    - Враги (движение, атака, смерть).
    - Эффекты (щиты, взрывы, сбор ресурсов).
- **Интерфейс:**
  - HUD:
    - Шкала здоровья игрока.
    - Миникарта этажа (дополняется по мере исследования этажа).
    - Инвентарь (полупрозрачно отображаются все поднятые предметы).
    - Ативный предмет и его заряд
    - Количество бомб и ключей.
    - 
  - Меню:
    - Пауза.
    - Настройки.

### 5) Звук и музыка
- **Звуковые эффекты:**
  - Атаки персонажа и врагов.
  - Подбор предметов.
  - Открытие дверей и сундуков.

- **Музыка:**
  - Фоновая музыка для каждого этажа.
  - Боевая музыка для комнат с врагами и боссами.

---

## Архитектура и дизайн

### Основные классы и модули

#### 1) Игровое ядро
- `GameWindow(arcade.Window)` — главное окно игры.
- `GameView(arcade.View)` — управление сценами (меню, игра, конец).
- `GameLogic` — обработка игровой логики и состояний.

#### 2) Игровые объекты
- `Player` — игрок:
  - `hp` (int)
  - `speed` (float)
  - `inventory` (list)
  - методы: `move()`, `take_damage()`, `use_item()`
- `Enemy` — базовый класс врага:
  - `hp` (int)
  - `damage` (int)
  - `attack_speed` (float)
  - методы: `patrol()`, `attack_player()`, `take_damage()`
- `Boss(Enemy)` — босс:
  - `phases` (list)
  - `special_abilities` (list)
- `MiniBoss(Enemy)` — мини-босс.

#### 3) Мир и уровни
- `Room` — комната:
  - `type` (str: "enemy", "treasure", "secret", "boss")
  - `enemies` (list)
  - `items` (list)
  - `connections` (dict)
- `Floor` — этаж:
  - `rooms` (list)
  - `boss` (Boss)
  - методы: `generate_rooms()`, `spawn_enemies()`
- `World` — мир игры:
  - `floors` (list)
  - `current_floor` (int)

#### 4) Предметы и инвентарь
- `Item` — базовый класс предмета:
  - `name` (str)
  - `type` (str: "weapon", "armor", "passive", "active", "resource")
  - `effect` (dict)
- `Inventory` — инвентарь:
  - `slots` (list)
  - `capacity` (int)
  - методы: `add_item()`, `use_item()`

#### 5) Система сделок
- `Deal` — сделка:
  - `type` (str: "devil", "angel")
  - `items` (list)
  - `cost` (int или особые условия)
- `DealManager` — менеджер сделок:
  - методы: `offer_deal()`, `accept_deal()`, `decline_deal()`

#### 6) Графика и анимации
- `SpriteManager` — управление спрайтами:
  - `player_sprites` (dict)
  - `enemy_sprites` (dict)
  - `effect_sprites` (dict)
- `AnimationManager` — управление анимациями:
  - методы: `load_animations()`, `play_animation()`

#### 7) Звук и музыка
- `SoundManager` — управление звуками:
  - `sounds` (dict)
  - `music` (dict)
  - методы: `play_sound()`, `play_music()`, `stop_music()`

#### 8) Интерфейс
- `HUD` — игровой интерфейс:
  - `health_bar` (arcade.Sprite)
  - `portative_inventory` (arcade.SpriteList)
  - `active_item` (arcade.Sprite)
  - `active_item_charge_bar` (arcade.Sprite)
  - `minimap` (arcade.SpriteList)
  - `resources` (arcade.SpriteList)
- `Menu` — меню игры:
  - `buttons` (list)
  - методы: `draw()`, `handle_click()`

---

## Горячие клавиши
- **W/A/S/D** — движение персонажа.
- **←, ↑, →, ↓** - выбор направления атаки и атака
- **Пробел** — активация активного предмета.
- **E** — взаимодействие с предметами/дверями.
- **I** — открыть/закрыть инвентарь.
- **ESC** — пауза/меню.
- **R** — перезарядка оружия (если требуется).
---

## Технические требования

### Используемые технологии
- **Язык:** Python 3.9+
- **Библиотека:** Arcade 2.6+
- **Дополнительные библиотеки (при необходимости):**
  - Для расширенной работы со звуком
  - Для загрузки тайловых карт
  - Для работы с данными (JSON/CSV)

### Требования к организации кода
- Многофайловая структура проекта с логическим разделением модулей
- Чистый, документированный код с комментариями
- Разделение логики, графики и данных
